<!DOCTYPE html>
<html lang="ko"
      xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>가자맵 엑셀 추가</title>
    <link th:href="@{/css/bootstrap.min.css}" href="../css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.0.3/css/font-awesome.css">
    <link th:href="@{/css/excel-form.css}" href="../css/excel-form.css" rel="stylesheet">
    <script src="https://code.jquery.com/jquery-3.6.1.slim.min.js" integrity="sha256-w8CvhFs7iHNVUtnSP0YKEg00p9Ih13rlL9zGqvLdePA=" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
    <script type="text/javascript" th:src="@{/js/excel-form.js}" src="../js/excel-form.js"></script>

    <script>
        $(document).ready(function() {
          // 폼 submit 이벤트 처리
          $("#msform").submit(function(event) {
            event.preventDefault(); // 기본 submit 동작을 막음

            // Ajax 요청
            $.ajax({
              type: "POST",
              url: $(this).attr("action"),
              data: new FormData(this),
              processData: false,
              contentType: false,
              success: function(response) {
                // Ajax 요청이 성공하면 성공 상태 표시
                $("#status-image").fadeOut(500, function() {
                  // 이미지 사라짐
                  $(this).attr("src", "/image/ok.png"); // 성공 이미지 URL로 변경
                }).fadeIn(500); // 이미지 나타남
                $("#status-message").fadeOut(500, function() {
                  // 메시지 사라짐
                  $(this).text("고객 정보 등록에 성공하였습니다. 앱에서 확인해주세요!"); // 성공 메시지로 변경
                }).fadeIn(500); // 메시지 나타남
                console.log(response);
              },
              error: function(xhr, status, error) {
                // Ajax 요청이 실패하면 실패 상태 표시
                $("#status-image").fadeOut(500, function() {
                  // 이미지 사라짐
                  $(this).attr("src", "/image/fail.png"); // 실패 이미지 URL로 변경
                }).fadeIn(500); // 이미지 나타남
                $("#status-message").fadeOut(500, function() {
                  // 메시지 사라짐
                  $(this).html(xhr.responseJSON.message); // 실패 메시지로 변경
                }).fadeIn(500); // 메시지 나타남
                console.log(xhr);
              }
            });
          });

          // 새로고침 이벤트 처리
          /*$(window).on('beforeunload', function() {
            window.location.href = '/clients/file';
          });*/
        });
    </script>

</head>
<body>
    <!-- MultiStep Form -->
    <div class="container-fluid" id="grad1">
        <div class="row justify-content-center mt-0">
            <div class="col-11 col-sm-9 col-md-7 col-lg-6 text-center p-0 mt-3 mb-2">
                <div class="card px-0 pt-4 pb-0 mt-3 mb-3">
                    <h1>(가자맵 로고)</h1>
                    <h2 class="mt-3"><strong>엑셀로 사용자 등록하기</strong></h2>
                    <p>모든 단계를 완료하면 사용자가 등록됩니다!</p>
                    <div class="row">
                        <div class="col-md-12 mx-0">
                            <form id="msform" action="/api/clients/file" method="post" enctype="multipart/form-data">
                                <!-- progressbar -->
                                <ul id="progressbar">
                                    <li class="active" id="personal"><strong>그룹 선택</strong></li>
                                    <li id="payment"><strong>엑셀 업로드</strong></li>
                                    <li id="confirm"><strong>등록 완료</strong></li>
                                </ul>
                                <fieldset>
                                    <div class="form-card">
                                        <div th:replace="fragments/group-radio :: fragment-group-radio(${groupList})">group-radio 공간</div>
                                    </div>
                                    <input type="button" name="next" class="next action-button" value="다음 단계"/>
                                </fieldset>
                                <fieldset>
                                    <div class="form-card">
                                        <div th:replace="fragments/excel-file-upload :: fragment-excel-file-upload">excel-file-upload 공간</div>
                                    </div>
                                    <input type="button" name="previous" class="previous action-button-previous" value="이전 단계"/>
<!--                                    <input type="button" name="make_payment" class="next action-button" value="완료"/>-->
                                    <input type="submit" name="make_payment" class="next action-button" value="완료"/>
                                </fieldset>
                                <fieldset>
                                    <div id="upload-success" th:replace="fragments/upload-status :: fragment-upload-status">등록 결과 공간</div>
                                </fieldset>
                            </form>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</body>
</html>